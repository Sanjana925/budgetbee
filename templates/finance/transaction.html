<div id="transactionModal" class="modal-overlay">
    <div class="modal-card">
        <h3>{% if transaction %}Edit{% else %}Add{% endif %} Transaction</h3>

        <form method="POST" id="transactionForm">
            {% csrf_token %}

            <!-- ================= Type Toggle ================= -->
            <div class="type-toggle">
                <button type="button" class="toggle-btn {% if transaction.type == 'income' %}active{% endif %}" data-type="income">Income</button>
                <button type="button" class="toggle-btn {% if transaction.type == 'expense' %}active{% endif %}" data-type="expense">Expense</button>
                <input type="hidden" name="type" id="typeInput" value="{{ transaction.type|default:'income' }}">
            </div>

            <label>Amount</label>
            <input type="number" step="0.01" name="amount"
                   value="{{ transaction.amount|default:'' }}" required>

            <label>Account</label>
            <select name="account" required>
                {% for acc in accounts %}
                    <option value="{{ acc.id }}"
                        {% if transaction and transaction.account.id == acc.id %}selected{% endif %}>
                        {{ acc.icon }} {{ acc.name }}
                    </option>
                {% endfor %}
            </select>

            <label>Category</label>
            <select name="category" id="categorySelect" required>
                {% for cat in categories %}
                    <option value="{{ cat.id }}" data-type="{{ cat.type }}"
                        {% if transaction and transaction.category.id == cat.id %}selected{% endif %}>
                        {{ cat.icon }} {{ cat.name }}
                    </option>
                {% endfor %}
            </select>

            <label>Date</label>
            <input type="date" name="date"
                   value="{{ transaction.date|date:'Y-m-d'|default:today|date:'Y-m-d' }}" required>

            <label>Note</label>
            <input type="text" name="note"
                   value="{{ transaction.note|default:'' }}"
                   placeholder="Optional">

            <div class="modal-actions">
                <button type="button" onclick="closeModal()">Cancel</button>
                <button type="submit">{% if transaction %}Save Changes{% else %}Add{% endif %}</button>
            </div>
        </form>
    </div>
</div>
